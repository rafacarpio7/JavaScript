<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
body {
        background-color: #fff;
        color: #333;
        font: 1em / 1.4 Helvetica Neue, Helvetica, Arial, sans-serif;
        padding: 1em;
        margin: 0;
      }

      * {
        box-sizing: border-box;
      }

      .errorMessage {
        color: red;
      }

     

      .error {
       border: 2px dotted red;

        box-sizing: border-box;
      }

      .error.active {
        padding: 0.3em;
      }
   
    </style>
</head>
<body>
    <!-- Confeccionar un formulario para crear una cuenta en una red social.
Campos obligatorios que se deben solicitar:
- Nombre (longitud entre 3 y 20 letras)
- Apellidos (longitud entre 4 y 40 letras)
- Usuario (longitud de al menos 7 caracteres alfanuméricos)
- Correo electrónico (validar que sea un correo)
- Número de teléfono: valor numérico de 9 cifras.
- Fecha de nacimiento (el usuario debe tener al menos 18 años
para poder crearse una cuenta). Validar que sea una fecha
valida.
- Marcar unos intereses de entre unos propuestos, poner al
menos 5 checkbox, obligando a marcar al menos 2.
- Cargar una foto de perfil, obligatoriamente, quedará visible al
final de la página.-->

<h1>Formulario Ejercicio 2</h1>
<form id="form"  method="get" novalidate>
    
    <label for="nombre">Nombre :</label>
    <input type="text" name="nombre" id="nombre" minlength="3" maxlength="20" required><br>

    <label for="apellidos">Apellidos : </label>
    <input type="text" name="apellidos" id="apellidos" minlength="4" maxlength="40" required><br>

    <label for="usuario">Usuario : </label>
    <input type="text" name="usuario" id="usuario" minlength="7" required><br>

    <label for="email">Email : </label>
    <input type="email" name="email" id="email" required><br>
    

    <label for="telefono">Telefono : </label>
    <input type="tel" name="telefono" id="telefono" pattern="^[6-9]\d{8}$" required><br>

    <label for="fechaNacimiento">Fecha Nacimiento: </label>
    <input type="date" name="fechaNacimiento" id="fechaNacimiento"  required><br>
    
    <span id="nombreError" class="errorMessage"></span> <br>
    <span id="apellidosError" class="errorMessage"></span> <br>
    <span id="usuarioError" class="errorMessage"></span> <br>
    <span id="emailError" class="errorMessage"></span> <br>
    <span id="telefonoError" class="errorMessage"></span> <br>
    <span id="fechaError" class="errorMessage"></span> <br>
    <input type="submit"id="btnEnviar" name="btnEnviar" value="validar">
    
</form>

<script>
    const nombre = document.getElementById('nombre');
    const apellidos = document.getElementById('apellidos');
    const user = document.getElementById('usuario');
    const email = document.getElementById('email');
    const telefono = document.getElementById('telefono');
    const fecha = document.getElementById('fechaNacimiento');
    const enviar = document.getElementById('btnEnviar');

    enviar.addEventListener('click', (event)=> {


    if (!nombre.checkValidity()) {
        
        nombre.className='error';
        if (nombre.validity.valueMissing) {
            document.getElementById('nombreError').innerHTML="<b>NOMBRE</b> campo obligatorio";
            event.preventDefault();

        } else if(nombre.validity.typeMismatch){
            document.getElementById('nombreError').innerHTML="<b>NOMBRE</b> no puede contener caracteres especiales ni numeros";
            event.preventDefault();

        } else if(nombre.validity.tooShort){
            document.getElementById('nombreError').innerHTML="<b>NOMBRE</b> debe tener entre 3 y 20 caracteres";
            event.preventDefault();

        } else if(nombre.validity.tooLong){
            document.getElementById('nombreError').innerHTML="<b>NOMBRE</b> debe tener entre 3 y 20 caracteres";
            event.preventDefault();

        }
    }else{
        nombre.className='';
        document.getElementById('nombreError').innerHTML="";
    }


    if (!apellidos.checkValidity()) {
        
        apellidos.className='error';
        if (apellidos.validity.valueMissing) {
            document.getElementById('apellidosError').innerHTML="<b>APELLIDOS</b> campo obligatorio";
            event.preventDefault();

        } else if(apellidos.validity.typeMismatch){
            document.getElementById('apellidosError').innerHTML="<b>APELLIDOS</b> no puede contener caracteres especiales ni numeros";
            event.preventDefault();

        } else if(apellidos.validity.tooShort){
            document.getElementById('apellidosError').innerHTML="<b>APELLIDOS</b> debe tener entre 4 y 40 caracteres";
            event.preventDefault();

        } else if(apellidos.validity.tooLong){
            document.getElementById('apellidosError').innerHTML="<b>APELLIDOS</b> debe tener entre 4 y 40 caracteres";
            event.preventDefault();

        }
    }else{
        apellidos.className='';
        document.getElementById('apellidosError').innerHTML="";
    }


        
    if (!user.checkValidity()) {
        
        user.className='error';
        if (user.validity.valueMissing) {
            document.getElementById('usuarioError').innerHTML="<b>USUARIO</b> campo obligatorio";
            event.preventDefault();

        } else if(user.validity.tooShort){
            document.getElementById('usuarioError').innerHTML="<b>USUARIO</b> debe tener al menos 7 caracteres";
            event.preventDefault();

        }
    }else{
        user.className='';
        document.getElementById('usuarioError').innerHTML="";
    }

    if (!email.checkValidity()) {
        
        email.className='error';
        if (email.validity.valueMissing) {
            document.getElementById('emailError').innerHTML="<b>CORREO</b> campo obligatorio";
            event.preventDefault();

        } else if(email.validity.typeMismatch){
            document.getElementById('emailError').innerHTML="<b>CORREO</b> introducido no es email";
            event.preventDefault();

        } else if(email.value !== user.value + "@gmail.com"){
            
            document.getElementById('emailError').innerHTML="<b>CORREO</b> debe ser "+user.value+"@gmail.com";
            event.preventDefault();

        }
    }else if(email.value !== user.value + "@gmail.com") {
        email.className='error';
        document.getElementById('emailError').innerHTML="<b>CORREO</b> debe ser "+user.value+"@gmail.com";
        event.preventDefault();

    }else{
        email.className='';
        document.getElementById('emailError').innerHTML="";
    }


    if (!telefono.checkValidity()) {
        
        telefono.className='error';
        if (telefono.validity.valueMissing) {
            document.getElementById('telefonoError').innerHTML="<b>TELEFFONO</b> campo obligatorio";
            event.preventDefault();

        } else if(telefono.validity.patternMismatch){
            document.getElementById('telefonoError').innerHTML="<b>TELEFFONO</b> debe comenzar 6, 7, 8 o 9 y tener una extension fija de 9 cifras";
            event.preventDefault();

        }
    }else{
        telefono.className='';
        document.getElementById('telefonoError').innerHTML="";
    }
    console.log(calcularEdad(fecha.value));
    if (!fecha.checkValidity()) {
        fecha.className='error';
        if (fecha.validity.valueMissing) {
            document.getElementById('fechaError').innerHTML="<b>FECHA</b> campo obligatorio";
            event.preventDefault();
        } else if(fecha.validity.patternMismatch){
            document.getElementById('fechaError').innerHTML="<b>FECHA</b> no es una fecha";
            event.preventDefault();
        }
    }else if(calcularEdad(fecha.value)<18 || calcularEdad(fecha.value)>99){
        
        document.getElementById('fechaError').innerHTML="La red social no es adecuada para usuarios menores de 18 o mayores de 99 años";
        event.preventDefault();

    }else{

        fecha.className='';
        document.getElementById('fechaError').innerHTML="";
    }

    });
    
    function calcularEdad(fecha_nacimiento) {
    let hoy = new Date();
    let cumpleanos = new Date(fecha_nacimiento);
    let edad = hoy.getFullYear() - cumpleanos.getFullYear();
    let m = hoy.getMonth() - cumpleanos.getMonth();
    if (m < 0 || (m === 0 && hoy.getDate() < cumpleanos.getDate())) {
        edad--;
    }
    return edad;
}
    

</script>
</body>
</html>